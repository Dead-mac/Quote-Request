
import React, { useState } from 'react';
import { FormData } from '../types';

interface FormFieldProps {
  id: keyof Pick<FormData, 'fullName' | 'email' | 'phone'>;
  label: string;
  value: string;
  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;
  onBlur: (e: React.FocusEvent<HTMLInputElement>) => void;
  error?: string;
  type?: string;
  placeholder?: string;
}

// Standalone FormField component, moved from inside PersonalInfoForm
const FormField: React.FC<FormFieldProps> = ({ id, label, value, onChange, onBlur, error, type = 'text', placeholder = '' }) => {
  const errorId = `${id}-error`;
  return (
    <div>
        <label htmlFor={id} className="block text-sm font-medium text-zinc-700 mb-1">
            {label}
        </label>
        <input
            type={type}
            id={id}
            value={value}
            onChange={onChange}
            onBlur={onBlur}
            placeholder={placeholder}
            className={`w-full px-4 py-3 bg-white border rounded-xl focus:outline-none focus:ring-2 transition-colors duration-200 ${
            error
                ? 'border-red-500 focus:border-red-500 focus:ring-red-500/20'
                : 'border-zinc-300 hover:border-zinc-400 focus:border-teal-500 focus:ring-teal-500/20'
            }`}
            aria-invalid={!!error}
            aria-describedby={error ? errorId : undefined}
        />
        {error && <p id={errorId} className="text-red-600 text-xs mt-1">{error}</p>}
    </div>
  );
}

interface PersonalInfoFormProps {
  onSubmit: (data: Pick<FormData, 'fullName' | 'email' | 'phone'>) => void;
  onBack: () => void;
  initialData?: Partial<FormData>;
}

const PersonalInfoForm: React.FC<PersonalInfoFormProps> = ({ onSubmit, onBack, initialData }) => {
  const [formData, setFormDataState] = useState({
    fullName: initialData?.fullName || '',
    email: initialData?.email || '',
    phone: initialData?.phone || '',
  });
  const [errors, setErrors] = useState<Partial<Record<keyof typeof formData, string>>>({});

  const validateField = (name: keyof typeof formData, value: string) => {
    switch (name) {
      case 'fullName':
        if (!value.trim()) return 'Full name is required.';
        break;
      case 'email':
        if (!value.trim()) return 'Email is required.';
        if (!/\S+@\S+\.\S+/.test(value)) return 'Email is invalid.';
        break;
      case 'phone':
        if (!value.trim()) return 'Phone number is required.';
        break;
    }
    return null;
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { id, value } = e.target;
    const key = id as keyof typeof formData;
    setFormDataState(prev => ({ ...prev, [key]: value }));
    
    const error = validateField(key, value);
    setErrors(prev => {
        const newErrors = { ...prev };
        if (error) {
            newErrors[key] = error;
        } else {
            delete newErrors[key];
        }
        return newErrors;
    });
  };
  
  const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {
    const { id, value } = e.target;
    const key = id as keyof typeof formData;
    const error = validateField(key, value);
    if (error) {
      setErrors(prev => ({ ...prev, [key]: error }));
    }
  };

  const validateAll = () => {
    const newErrors: Partial<Record<keyof typeof formData, string>> = {};
    const keys: (keyof typeof formData)[] = ['fullName', 'email', 'phone'];
    for (const key of keys) {
      const error = validateField(key, formData[key]);
      if (error) {
        newErrors[key] = error;
      }
    }
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (validateAll()) {
      onSubmit(formData);
    }
  };
  
  return (
    <div className="animate-fade-in">
      <h2 className="text-2xl sm:text-3xl font-bold text-center text-zinc-800 mb-2">Tell us about yourself</h2>
      <p className="text-center text-zinc-600 mb-8">We need some basic information to get started.</p>
      <form onSubmit={handleSubmit} className="space-y-6 max-w-lg mx-auto">
        <FormField id="fullName" label="Full Name" value={formData.fullName} onChange={handleChange} onBlur={handleBlur} error={errors.fullName} placeholder="e.g., Jane Doe"/>
        <FormField id="email" label="Email Address" value={formData.email} onChange={handleChange} onBlur={handleBlur} error={errors.email} type="email" placeholder="you@example.com"/>
        <FormField id="phone" label="Phone Number" value={formData.phone} onChange={handleChange} onBlur={handleBlur} error={errors.phone} type="tel" placeholder="(555) 123-4567"/>
        <div className="flex flex-col-reverse sm:flex-row gap-4 pt-4">
          <button type="button" onClick={onBack} className="w-full px-6 py-3 bg-zinc-100 text-zinc-700 font-semibold rounded-lg hover:bg-zinc-200 transition-colors">
            Back
          </button>
          <button type="submit" className="w-full px-6 py-3 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm hover:shadow-md">
            Continue
          </button>
        </div>
      </form>
    </div>
  );
};

export default PersonalInfoForm;
